<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - La R√©publique et la Citoyennet√©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .question-enter {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .correct {
            background-color: #10b981 !important;
            border-color: #10b981 !important;
            color: white !important;
        }
        .incorrect {
            background-color: #ef4444 !important;
            border-color: #ef4444 !important;
            color: white !important;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-white dark:bg-[#181818] text-gray-900 dark:text-gray-100 min-h-screen transition-colors">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-2 text-primary">Quiz - La R√©publique et la Citoyennet√©</h1>
            <p class="text-gray-600 dark:text-gray-400 text-base">Testez vos connaissances sur les fondements de la R√©publique fran√ßaise et la citoyennet√©</p>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="bg-gray-50 dark:bg-gray-800 rounded-lg shadow-lg p-8 text-center">
            <div class="mb-6">
                <svg class="w-20 h-20 mx-auto text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                </svg>
            </div>
            <h2 class="text-2xl font-bold mb-4">Pr√™t √† commencer ?</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6 text-base">Ce quiz contient 18 questions sur la R√©publique et la Citoyennet√©, incluant des questions √† r√©ponse textuelle.</p>
            <button onclick="startQuiz()" class="bg-primary hover:bg-opacity-90 text-white font-semibold py-3 px-8 rounded-lg transition-all transform hover:scale-105 text-base">
                Commencer le quiz
            </button>
            <div class="mt-6 text-sm text-gray-500 dark:text-gray-400">
                <p class="mb-2">‚å®Ô∏è Raccourcis clavier :</p>
                <p><kbd class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded text-xs">Entr√©e</kbd> pour commencer</p>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-600 dark:text-gray-400">Question <span id="currentQuestion">1</span> / <span id="totalQuestions">18</span></span>
                    <span class="text-sm font-semibold text-primary"><span id="score">0</span> points</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                    <div id="progressBar" class="bg-primary h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- Question Card -->
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg shadow-lg p-6 md:p-8 mb-6 question-enter">
                <h3 id="questionText" class="text-xl md:text-2xl font-bold mb-6 text-gray-900 dark:text-gray-100"></h3>
                <div id="answersContainer" class="space-y-3"></div>
            </div>

            <!-- Feedback -->
            <div id="feedback" class="hidden mb-6 p-4 rounded-lg">
                <p id="feedbackText" class="font-semibold text-base"></p>
                <p id="explanationText" class="mt-2 text-sm"></p>
            </div>

            <!-- Next Button -->
            <div class="text-center">
                <button id="nextBtn" onclick="nextQuestion()" class="hidden bg-primary hover:bg-opacity-90 text-white font-semibold py-3 px-8 rounded-lg transition-all text-base">
                    Question suivante ‚Üí
                </button>
                <div class="mt-4 text-sm text-gray-500 dark:text-gray-400">
                    <p>‚å®Ô∏è Raccourcis :
                        <span id="quizShortcuts">
                            <kbd class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded text-xs">A-D</kbd> ou
                            <kbd class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded text-xs">1-4</kbd> pour r√©pondre ‚Ä¢
                        </span>
                        <kbd class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded text-xs">Entr√©e</kbd> pour valider/continuer
                    </p>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg shadow-lg p-8 text-center">
                <div class="mb-6">
                    <svg id="resultIcon" class="w-24 h-24 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h2 class="text-3xl font-bold mb-4">Quiz termin√© !</h2>
                <p class="text-xl mb-2">Votre score :</p>
                <p id="finalScore" class="text-5xl font-bold text-primary mb-6">0/18</p>
                <p id="resultMessage" class="text-gray-600 dark:text-gray-400 mb-8 text-base"></p>

                <!-- Score Details -->
                <div class="bg-white dark:bg-gray-700 rounded-lg p-6 mb-6">
                    <h3 class="font-semibold mb-4 text-lg">D√©tails</h3>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <p class="text-2xl font-bold text-green-500" id="correctCount">0</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Correctes</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-red-500" id="incorrectCount">0</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Incorrectes</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-primary" id="percentageScore">0%</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">R√©ussite</p>
                        </div>
                    </div>
                </div>

                <!-- Section des erreurs -->
                <div id="mistakesSection" class="mt-6"></div>

                <button onclick="restartQuiz()" class="bg-primary hover:bg-opacity-90 text-white font-semibold py-3 px-8 rounded-lg transition-all transform hover:scale-105 text-base">
                    Recommencer le quiz
                </button>
                <div class="mt-4 text-sm text-gray-500 dark:text-gray-400">
                    <p>‚å®Ô∏è <kbd class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded text-xs">Entr√©e</kbd> pour recommencer</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Quiz data
        const quizData = [
            {
                question: "Quel est la valeur fran√ßaise qui n'est pas dans la devise ?",
                type: "multiple-choice",
                answers: [
                    "Libert√©",
                    "√âgalit√©",
                    "Fraternit√©",
                    "La√Øcit√©"
                ],
                correct: 3,
                explanation: "La devise c'est libert√©, √©galit√©, fraternit√©, donc la seule valeur qui n'est pas dans la devise est la la√Øcit√©"
            },
            {
                question: "Selon l'Article 1 de la Constitution de 1958, la France est une R√©publique...",
                type: "multiple-choice",
                answers: [
                    "unie, libre, fraternelle et juste.",
                    "parlementaire, la√Øque, d√©mocratique et solidaire.",
                    "indivisible, la√Øque, d√©mocratique et sociale.",
                    "f√©d√©rale, la√Øque, indivisible et sociale."
                ],
                correct: 2,
                explanation: "C'est la formulation exacte de l'Article 1 de la Constitution de 1958."
            },
          {
                question: "Les symboles r√©publicains ont √©t√© choisis pendant quelle R√©publique ?",
                type: "multiple-choice",
                answers: [
                    "La IIe R√©publique",
                    "La IIIe R√©publique",
                    "La IVe R√©publique",
                    "La Ve R√©publique"
                ],
                correct: 1,
                explanation: "Les symboles sont n√©s au cours de la R√©volution fran√ßaise et ont √©t√© choisis comme des symboles r√©publicains pendant la IIIe R√©publique"
            },
            {
                question: "Quel est la date de d√©but de la IIIe R√©publique ?",
                type: "text",
                correct: ["1870"],
                explanation: "1870"
            },
            {
                question: "Quel est la date de fin de la IIIe R√©publique ?",
                type: "text",
                correct: ["1940"],
                explanation: "1940"
            },
            {
                question: "Quel est la date de la Constitution de la Ve R√©publique ?",
                type: "text",
                correct: ["1958"],
                explanation: "1958"
            },
            {
                question: "Quel est la date de la loi de s√©paration de l'√âglise et l'√âtat ?",
                type: "text",
                correct: ["1905"],
                explanation: "1905"
            },
            {
                question: "En quelle ann√©e la S√©curit√© sociale a-t-elle √©t√© cr√©√©e en France, permettant l'acc√®s aux soins √† tous ?",
                type: "text",
                correct: ["1945"],
                explanation: "La S√©curit√© sociale a √©t√© cr√©√©e en 1945."
            },
            {
                question: "Parmi les symboles suivants, lequel n'est PAS un symbole r√©publicain n√© de la R√©volution fran√ßaise et choisi pendant la IIIe R√©publique ?",
                type: "multiple-choice",
                answers: [
                    "Le drapeau tricolore",
                    "La Marseillaise",
                    "Marianne",
                    "Le 4 juillet"
                ],
                correct: 3,
                explanation: "Le drapeau tricolore, la Marseillaise, la devise ¬´ Libert√©, √©galit√©, fraternit√© ¬ª et Marianne sont des symboles r√©publicains n√©s de la R√©volution fran√ßaise et adopt√©s pendant la IIIe R√©publique. En revanche, le 4 juillet est la f√™te nationale des √âtats-Unis et n'a aucun lien avec les symboles r√©publicains fran√ßais ni avec la R√©volution fran√ßaise ou la IIIe R√©publique."
            },
            {
                question: "Quelle est la signification du principe selon lequel la R√©publique est 'indivisible' ?",
                type: "multiple-choice",
                answers: [
                    "Le territoire fran√ßais ne peut √™tre s√©par√©.",
                    "La loi est la m√™me pour tous et chacun dispose des m√™mes droits.",
                    "Le pouvoir est centralis√© et non partag√©.",
                    "L'√©cole est gratuite."
                ],
                correct: 1,
                explanation: "La loi est la m√™me pour tous, chacun dispose des m√™mes droits : la R√©publique est indivisible."
            },
            {
                question: "Si seulement un de mes parents adoptif est fran√ßais suis-je de nationalit√© fran√ßaise ?",
                type: "multiple-choice",
                answers: [
                    "Oui",
                    "Non"
                ],
                correct: 0,
                explanation: "Je suis fran√ßais si un de mes parents naturels ou adoptifs est fran√ßais"
            },
            {
                question: "Si je suis n√©(e) de parents √©trangers sur le territoire fran√ßais, ai-je imm√©diatement la nationalit√© fran√ßaise ?",
                type: "multiple-choice",
                answers: [
                    "Oui",
                    "Non"
                ],
                correct: 1,
                explanation: "Je peux seulement l'obtenir √† 13 ou 16 ans apr√®s d√©claration et sous certaines conditions"
            },
            {
                question: "Quel type de droit est sp√©cifiquement r√©serv√© aux citoyens fran√ßais et n'est pas accessible aux √©trangers r√©sidant en France ?",
                type: "multiple-choice",
                answers: [
                    "Les droits civils (libert√© d'expression).",
                    "Les droits sociaux (droit √† la S√©curit√© sociale).",
                    "Les droits politiques (droit de vote, d'√©ligibilit√©).",
                    "Le droit √† l'instruction."
                ],
                correct: 2,
                explanation: "Le document stipule que 'Les √©trangers r√©sidant sur le territoire n‚Äôont pas ces droits politiques.' Les autres sont des droits civils ou sociaux partag√©s."
            },
            {
                question: "Les √©trangers r√©sidant et travaillant en France doivent-ils payer les impots ?",
                type: "multiple-choice",
                answers: [
                    "Oui",
                    "Non"
                ],
                correct: 0,
                explanation: ""
            },
            {
                question: "De quand date le trait√© de Maastricht ?",
                type: "text",
                correct: ["1992"],
                explanation: "1992"
            },
            {
                question: "Que NE peuvent PAS faire les citoyens europ√©ens ?",
                type: "multiple-choice",
                answers: [
                    "S'installer librement dans un pays de l'UE",
                    "√âlire les d√©put√©s du parlement europ√©en",
                    "Voter aux √©lections nationales dans un autre pays de l'UE",
                    "Conduire avec le m√™me permis de conduire que ton pays d'origine"
                ],
                correct: 2,
                explanation: "Les citoyens europ√©ens peuvent s'installer librement, √©lire les d√©put√©s europ√©ens, et conduire avec leur permis national, mais ne peuvent pas voter aux √©lections nationales dans un autre pays membre de l'UE."
            },
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let incorrectAnswers = 0;
        let answered = false;
        let userAnswers = []; // Stocker les r√©ponses de l'√©l√®ve
        let currentShuffledAnswers = []; // Stores the shuffled answers for the current question, with their original indices

        /**
         * Shuffles an array in place using the Fisher-Yates (Knuth) algorithm.
         * @param {Array} array The array to shuffle.
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
        }

        /**
         * Normalizes a text answer for comparison (lowercase, trim, single spaces, simplified date parts).
         * @param {string} text The text to normalize.
         * @returns {string} The normalized text.
         */
        function normalizeTextAnswer(text) {
            // Convert to lowercase, trim whitespace
            // Replace common date separators with space
            // Replace multiple spaces with single space
            // Remove "er", "√®re", "√®me", "e" after a digit (e.g., "1er mai" -> "1 mai")
            return text.toLowerCase().trim()
                       .replace(/(\d)\s*(er|√®re|√®me|e)\s*/g, '$1 ') // "1er mai" -> "1 mai"
                       .replace(/[\.,\-\/]/g, ' ') // Replace punctuation with space
                       .replace(/\s+/g, ' '); // Replace multiple spaces with single space
        }

        function startQuiz() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            currentQuestionIndex = 0;
            score = 0;
            correctAnswers = 0;
            incorrectAnswers = 0;
            answered = false;
            userAnswers = []; // R√©initialiser les r√©ponses
            displayQuestion();
        }

        function displayQuestion() {
            answered = false;
            const question = quizData[currentQuestionIndex];

            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('totalQuestions').textContent = quizData.length;
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');

            // Update progress bar
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = ''; // Clear previous answers

            // Update keyboard shortcuts display
            const quizShortcuts = document.getElementById('quizShortcuts');
            if (question.type === 'text') {
                quizShortcuts.classList.add('hidden');
            } else {
                quizShortcuts.classList.remove('hidden');
            }

            if (question.type === 'text') {
                // Display text input field
                const input = document.createElement('input');
                input.type = 'text';
                input.id = 'textAnswerInput';
                input.placeholder = 'Votre r√©ponse...';
                input.className = 'w-full p-4 rounded-lg border-2 border-gray-300 dark:border-gray-600 focus:border-primary focus:ring-primary focus:ring-1 outline-none transition-all text-base bg-white dark:bg-gray-800';
                answersContainer.appendChild(input);

                const submitButton = document.createElement('button');
                submitButton.id = 'submitTextBtn';
                submitButton.className = 'w-full mt-3 bg-primary hover:bg-opacity-90 text-white font-semibold py-3 px-8 rounded-lg transition-all text-base';
                submitButton.textContent = 'Valider la r√©ponse';
                submitButton.onclick = () => handleAnswerSubmission();
                answersContainer.appendChild(submitButton);

                input.focus(); // Focus the input field
            } else {
                // Display multiple-choice buttons
                const answersWithOriginalIndex = question.answers.map((text, originalIndex) => ({ text, originalIndex }));
                
                shuffleArray(answersWithOriginalIndex);
                currentShuffledAnswers = answersWithOriginalIndex; // Store for later use in handleAnswerSubmission

                currentShuffledAnswers.forEach((answerObj, shuffledIndex) => {
                    const button = document.createElement('button');
                    button.className = 'w-full text-left p-4 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-primary hover:bg-gray-100 dark:hover:bg-gray-700 transition-all text-base bg-white dark:bg-gray-800';
                    button.innerHTML = `<span class="font-semibold">${String.fromCharCode(65 + shuffledIndex)}.</span> ${answerObj.text}`;
                    button.onclick = () => handleAnswerSubmission(shuffledIndex); // Pass the shuffled index
                    answersContainer.appendChild(button);
                });
            }
        }

        function handleAnswerSubmission(selectedShuffledIndex = null) {
            if (answered) return; // Prevent double submission
            answered = true;

            const question = quizData[currentQuestionIndex];
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            const explanationText = document.getElementById('explanationText');

            let isCorrect = false;
            let userAnswerDisplay = ''; // To show user's input in results
            let correctAnswerDisplay = ''; // To show correct answer in results

            if (question.type === 'text') {
                const textInput = document.getElementById('textAnswerInput');
                const userInputValue = textInput.value;
                userAnswerDisplay = userInputValue; // Store raw input for display
                const normalizedUserInput = normalizeTextAnswer(userInputValue);
                
                // Check if normalized user input matches any of the correct answers
                isCorrect = question.correct.some(correctStr => normalizeTextAnswer(correctStr) === normalizedUserInput);
                correctAnswerDisplay = question.correct[0]; // Use the first correct answer for display

                // Disable input and button
                textInput.disabled = true;
                document.getElementById('submitTextBtn').disabled = true;

            } else { // Multiple-choice
                const buttons = document.getElementById('answersContainer').children;
                const selectedAnswerOriginalIndex = currentShuffledAnswers[selectedShuffledIndex].originalIndex;
                const correctAnswerOriginalIndex = question.correct;
                
                isCorrect = (selectedAnswerOriginalIndex === correctAnswerOriginalIndex);
                userAnswerDisplay = question.answers[selectedAnswerOriginalIndex]; // Store MC text for display
                correctAnswerDisplay = question.answers[correctAnswerOriginalIndex];

                // Disable all MC buttons
                for (let btn of buttons) {
                    btn.classList.add('disabled');
                }

                // Highlight correct/incorrect MC buttons
                if (isCorrect) {
                    buttons[selectedShuffledIndex].classList.add('correct');
                } else {
                    buttons[selectedShuffledIndex].classList.add('incorrect');
                    const correctButtonShuffledIndex = currentShuffledAnswers.findIndex(
                        ans => ans.originalIndex === correctAnswerOriginalIndex
                    );
                    if (correctButtonShuffledIndex !== -1) {
                        buttons[correctButtonShuffledIndex].classList.add('correct');
                    }
                }
            }

            // Common feedback logic
            if (isCorrect) {
                score++;
                correctAnswers++;
                feedbackText.textContent = '‚úì Correct !';
                feedbackText.className = 'font-semibold text-green-600 dark:text-green-400 text-base';
                feedback.className = 'mb-6 p-4 rounded-lg bg-green-50 dark:bg-green-900/30 border-2 border-green-500';
            } else {
                incorrectAnswers++;
                feedbackText.textContent = '‚úó Incorrect';
                feedbackText.className = 'font-semibold text-red-600 dark:text-red-400 text-base';
                feedback.className = 'mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/30 border-2 border-red-500';
            }

            explanationText.textContent = question.explanation;
            explanationText.className = 'mt-2 text-sm text-gray-700 dark:text-gray-300';
            feedback.classList.remove('hidden');

            document.getElementById('score').textContent = score;
            document.getElementById('nextBtn').classList.remove('hidden');

            // Store user's answer for results screen
            userAnswers.push({
                questionIndex: currentQuestionIndex,
                userAnswer: userAnswerDisplay,
                correctAnswer: correctAnswerDisplay,
                isCorrect: isCorrect,
                questionType: question.type
            });
        }

        function nextQuestion() {
            currentQuestionIndex++;

            if (currentQuestionIndex < quizData.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');

            const percentage = Math.round((score / quizData.length) * 100);

            document.getElementById('finalScore').textContent = `${score}/${quizData.length}`;
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('incorrectCount').textContent = incorrectAnswers;
            document.getElementById('percentageScore').textContent = percentage + '%';

            // Result message
            let message = '';
            const resultIcon = document.getElementById('resultIcon');

            if (percentage >= 90) {
                message = 'Excellent ! Vous ma√Ætrisez parfaitement les fondements de la R√©publique et de la Citoyennet√© ! üéâ';
                resultIcon.className = 'w-24 h-24 mx-auto text-green-500';
            } else if (percentage >= 70) {
                message = 'Tr√®s bien ! Vous avez de bonnes connaissances sur le sujet. üëç';
                resultIcon.className = 'w-24 h-24 mx-auto text-blue-500';
            } else if (percentage >= 50) {
                message = 'Pas mal ! Continuez √† r√©viser pour am√©liorer votre score. üìö';
                resultIcon.className = 'w-24 h-24 mx-auto text-yellow-500';
            } else {
                message = 'Continuez vos r√©visions ! Relisez la fiche et r√©essayez. üí™';
                resultIcon.className = 'w-24 h-24 mx-auto text-red-500';
            }

            document.getElementById('resultMessage').textContent = message;

            // Afficher les erreurs de l'√©l√®ve
            displayMistakes();
        }

        function displayMistakes() {
            const mistakesSection = document.getElementById('mistakesSection');
            const mistakes = userAnswers.filter(answer => !answer.isCorrect);

            if (mistakes.length === 0) {
                mistakesSection.innerHTML = `
                    <div class="bg-green-50 dark:bg-green-900/30 border-2 border-green-500 rounded-lg p-6">
                        <h3 class="text-xl font-bold text-green-600 dark:text-green-400 mb-2">üéâ Parfait !</h3>
                        <p class="text-gray-700 dark:text-gray-300 text-base">Vous n'avez fait aucune erreur ! F√©licitations !</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="bg-white dark:bg-gray-700 rounded-lg p-6 text-left">
                    <h3 class="text-xl font-bold mb-4 text-red-500">üìã Vos erreurs (${mistakes.length})</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Voici les questions o√π vous vous √™tes tromp√©(e) :</p>
                    <div class="space-y-4">
            `;

            mistakes.forEach((mistake, index) => {
                const question = quizData[mistake.questionIndex];
                html += `
                    <div class="border-l-4 border-red-500 bg-red-50 dark:bg-red-900/20 p-4 rounded">
                        <p class="font-semibold text-gray-900 dark:text-gray-100 mb-2">
                            <span class="text-red-500">Question ${mistake.questionIndex + 1}:</span> ${question.question}
                        </p>
                        <div class="ml-4 space-y-1 text-sm">
                            <p class="text-red-600 dark:text-red-400">
                                ‚úó <span class="font-medium">Votre r√©ponse :</span> ${mistake.userAnswer || '[Non r√©pondu]'}
                            </p>
                            <p class="text-green-600 dark:text-green-400">
                                ‚úì <span class="font-medium">Bonne r√©ponse :</span> ${mistake.correctAnswer}
                            </p>
                            <p class="text-gray-600 dark:text-gray-400 italic mt-2">
                                üí° ${question.explanation}
                            </p>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            mistakesSection.innerHTML = html;
        }

        function restartQuiz() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }

        // Gestion des touches clavier
        document.addEventListener('keydown', (event) => {
            const key = event.key.toLowerCase();
            const quizScreen = document.getElementById('quizScreen');
            const startScreen = document.getElementById('startScreen');
            const resultsScreen = document.getElementById('resultsScreen');

            // Enter pour commencer, suivant, ou recommencer
            if (key === 'enter') {
                if (!startScreen.classList.contains('hidden')) {
                    startQuiz();
                    event.preventDefault();
                } else if (!quizScreen.classList.contains('hidden')) {
                    const question = quizData[currentQuestionIndex];
                    if (answered) { // Already answered, move to next
                        nextQuestion();
                    } else if (question.type === 'text') { // Text question, not answered, submit
                        handleAnswerSubmission();
                    }
                    event.preventDefault();
                } else if (!resultsScreen.classList.contains('hidden')) {
                    restartQuiz();
                    event.preventDefault();
                }
            }

            // Touches 1-4 ou A-D pour s√©lectionner une r√©ponse (seulement pour MC et si pas encore r√©pondu)
            if (!quizScreen.classList.contains('hidden') && !answered) {
                const question = quizData[currentQuestionIndex];
                if (question.type !== 'text') {
                    let answerIndex = -1; // This will be the shuffled index

                    // Touches num√©riques 1-4
                    if (key >= '1' && key <= '4') {
                        answerIndex = parseInt(key) - 1;
                    }
                    // Touches A-D
                    else if (key === 'a') answerIndex = 0;
                    else if (key === 'b') answerIndex = 1;
                    else if (key === 'c') answerIndex = 2;
                    else if (key === 'd') answerIndex = 3;

                    // Check if the selected index is valid for the current shuffled answers
                    if (answerIndex >= 0 && answerIndex < currentShuffledAnswers.length) {
                        handleAnswerSubmission(answerIndex);
                        event.preventDefault();
                    }
                }
            }
        });
    </script>
</body>
</html>
