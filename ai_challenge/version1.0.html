<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Personalized Learning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A49C7'
                    }
                }
            }
        }
    </script>
    <style>
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            font-weight: bold;
            margin: 1rem 0 0.5rem 0;
        }
        .markdown-content h1 { font-size: 1.5rem; }
        .markdown-content h2 { font-size: 1.25rem; }
        .markdown-content h3 { font-size: 1.125rem; }
        .markdown-content p { margin: 0.5rem 0; }
        .markdown-content ul, .markdown-content ol { margin: 0.5rem 0; padding-left: 1.5rem; }
        .markdown-content code { background: #f3f4f6; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-family: monospace; }
        .markdown-content pre { background: #f3f4f6; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 0.5rem 0; }
        .dark .markdown-content code, .dark .markdown-content pre { background: #374151; }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-primary mb-2">ðŸŽ¯ AI Learning Platform</h1>
            <p class="text-gray-600 dark:text-gray-300">Your personalized AI tutor for mastering new skills</p>
        </header>

        <!-- Navigation -->
        <nav class="flex flex-wrap justify-center gap-4 mb-8">
            <button id="profileTab" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all active">ðŸ‘¤ Profile</button>
            <button id="learningPathTab" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all">ðŸ“š Learning Path</button>
            <button id="quizTab" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all">ðŸ§ª Quiz</button>
            <button id="chatTab" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all">ðŸ’¬ AI Tutor</button>
            <button id="progressTab" class="tab-btn px-6 py-3 rounded-lg font-medium transition-all">ðŸ“Š Progress</button>
        </nav>

        <!-- Profile Section -->
        <section id="profileSection" class="tab-content">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6">Create Your Learning Profile</h2>
                <form id="profileForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Name</label>
                        <input type="text" id="name" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="Your name" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Age</label>
                        <input type="number" id="age" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="Your age" required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium mb-2">Learning Goal</label>
                        <input type="text" id="goal" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="e.g., Learn Python for data analysis" required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium mb-2">Current Knowledge</label>
                        <textarea id="currentKnowledge" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600" rows="3" placeholder="Describe what you already know about this topic"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Preferred Learning Format</label>
                        <select id="preferredFormat" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                            <option value="Video and interactive exercises">Video and interactive exercises</option>
                            <option value="Reading and practice">Reading and practice</option>
                            <option value="Hands-on projects">Hands-on projects</option>
                            <option value="Mixed format">Mixed format</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Available Time Per Week</label>
                        <select id="availableTime" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                            <option value="2-3 hours">2-3 hours</option>
                            <option value="5 hours">5 hours</option>
                            <option value="8-10 hours">8-10 hours</option>
                            <option value="15+ hours">15+ hours</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Learning Style</label>
                        <select id="learningStyle" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                            <option value="Visual and hands-on">Visual and hands-on</option>
                            <option value="Auditory">Auditory</option>
                            <option value="Reading/Writing">Reading/Writing</option>
                            <option value="Kinesthetic">Kinesthetic</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Experience Level</label>
                        <select id="experienceLevel" class="w-full px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                            <option value="Beginner">Beginner</option>
                            <option value="Intermediate">Intermediate</option>
                            <option value="Advanced">Advanced</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-medium py-3 px-6 rounded-lg transition-colors">
                            Generate My Learning Path ðŸš€
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Learning Path Section -->
        <section id="learningPathSection" class="tab-content hidden">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8">
                <h2 class="text-2xl font-bold mb-6">ðŸ“š Your Personalized Learning Path</h2>
                <div id="learningPathContent" class="space-y-6">
                    <p class="text-gray-600 dark:text-gray-300">Complete your profile first to generate your personalized learning path.</p>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quizSection" class="tab-content hidden">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8">
                <h2 class="text-2xl font-bold mb-6">ðŸ§ª Interactive Quiz</h2>
                <div id="quizContent">
                    <p class="text-gray-600 dark:text-gray-300">Complete a module from your learning path to unlock quizzes.</p>
                </div>
            </div>
        </section>

        <!-- Chat Section -->
        <section id="chatSection" class="tab-content hidden">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8 h-96 flex flex-col">
                <h2 class="text-2xl font-bold mb-6">ðŸ’¬ AI Tutor Chat</h2>
                <div id="chatMessages" class="flex-1 overflow-y-auto space-y-4 mb-4 p-4 bg-white dark:bg-gray-700 rounded-lg">
                    <div class="text-gray-600 dark:text-gray-300">ðŸ‘‹ Hi! I'm your AI tutor. Ask me anything about your learning topics!</div>
                </div>
                <div class="flex gap-2">
                    <input type="text" id="chatInput" class="flex-1 px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="Ask your AI tutor..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button onclick="sendMessage()" class="bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg transition-colors">Send</button>
                </div>
            </div>
        </section>

        <!-- Progress Section -->
        <section id="progressSection" class="tab-content hidden">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-8">
                <h2 class="text-2xl font-bold mb-6">ðŸ“Š Your Progress</h2>
                <div id="progressContent" class="space-y-6">
                    <p class="text-gray-600 dark:text-gray-300">Start learning to track your progress here.</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Global variables
        let userProfile = null;
        let currentQuiz = null;
        let progressData = {
            completedModules: [],
            quizScores: [],
            totalTime: 0
        };

        // Tab management
        const tabs = document.querySelectorAll('.tab-btn');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetId = tab.id.replace('Tab', 'Section');
                showTab(targetId);
                
                // Update active tab styling
                tabs.forEach(t => t.classList.remove('active', 'bg-primary', 'text-white'));
                tabs.forEach(t => t.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300'));
                tab.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                tab.classList.add('active', 'bg-primary', 'text-white');
            });
        });

        function showTab(targetId) {
            contents.forEach(content => content.classList.add('hidden'));
            document.getElementById(targetId).classList.remove('hidden');
        }

        // Initialize active tab styling
        document.addEventListener('DOMContentLoaded', () => {
            tabs.forEach(t => t.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300'));
            document.getElementById('profileTab').classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            document.getElementById('profileTab').classList.add('bg-primary', 'text-white');
        });

        // Profile form submission
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Collect form data
            userProfile = {
                name: document.getElementById('name').value,
                age: parseInt(document.getElementById('age').value),
                goal: document.getElementById('goal').value,
                currentKnowledge: document.getElementById('currentKnowledge').value,
                preferredFormat: document.getElementById('preferredFormat').value,
                availableTimePerWeek: document.getElementById('availableTime').value,
                learningStyle: document.getElementById('learningStyle').value,
                experienceLevel: document.getElementById('experienceLevel').value,
                language: "English"
            };

            // Generate learning path
            await generateLearningPath();
            
            // Switch to learning path tab
            showTab('learningPathSection');
            tabs.forEach(t => t.classList.remove('active', 'bg-primary', 'text-white'));
            tabs.forEach(t => t.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300'));
            document.getElementById('learningPathTab').classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            document.getElementById('learningPathTab').classList.add('active', 'bg-primary', 'text-white');
        });

        // Register AI handler for learning path generation
        if (window.Poe) {
            window.Poe.registerHandler("learning-path-handler", (result) => {
                const msg = result.responses[0];
                if (msg.status === "error") {
                    document.getElementById('learningPathContent').innerHTML = `<div class="text-red-500">Error generating learning path: ${msg.statusText}</div>`;
                } else if (msg.status === "complete") {
                    const content = marked.parse(msg.content);
                    document.getElementById('learningPathContent').innerHTML = `<div class="markdown-content">${content}</div>`;
                } else if (msg.status === "incomplete") {
                    const content = marked.parse(msg.content);
                    document.getElementById('learningPathContent').innerHTML = `<div class="markdown-content">${content}</div><div class="text-primary animate-pulse mt-4">Generating your personalized path...</div>`;
                }
            });

            window.Poe.registerHandler("quiz-handler", (result) => {
                const msg = result.responses[0];
                if (msg.status === "error") {
                    document.getElementById('quizContent').innerHTML = `<div class="text-red-500">Error generating quiz: ${msg.statusText}</div>`;
                } else if (msg.status === "complete") {
                    const content = marked.parse(msg.content);
                    document.getElementById('quizContent').innerHTML = `<div class="markdown-content">${content}</div>`;
                } else if (msg.status === "incomplete") {
                    const content = marked.parse(msg.content);
                    document.getElementById('quizContent').innerHTML = `<div class="markdown-content">${content}</div><div class="text-primary animate-pulse mt-4">Generating quiz...</div>`;
                }
            });

            window.Poe.registerHandler("chat-handler", (result) => {
                const msg = result.responses[0];
                const messagesDiv = document.getElementById('chatMessages');
                
                if (msg.status === "error") {
                    messagesDiv.innerHTML += `<div class="bg-red-100 dark:bg-red-900 p-3 rounded-lg">Error: ${msg.statusText}</div>`;
                } else if (msg.status === "complete") {
                    const lastMessage = messagesDiv.lastElementChild;
                    if (lastMessage && lastMessage.classList.contains('ai-response')) {
                        const content = marked.parse(msg.content);
                        lastMessage.innerHTML = `<div class="markdown-content">${content}</div>`;
                    } else {
                        const content = marked.parse(msg.content);
                        messagesDiv.innerHTML += `<div class="ai-response bg-blue-100 dark:bg-blue-900 p-3 rounded-lg"><div class="markdown-content">${content}</div></div>`;
                    }
                } else if (msg.status === "incomplete") {
                    const lastMessage = messagesDiv.lastElementChild;
                    if (lastMessage && lastMessage.classList.contains('ai-response')) {
                        const content = marked.parse(msg.content);
                        lastMessage.innerHTML = `<div class="markdown-content">${content}</div><div class="text-primary animate-pulse">Thinking...</div>`;
                    } else {
                        const content = marked.parse(msg.content);
                        messagesDiv.innerHTML += `<div class="ai-response bg-blue-100 dark:bg-blue-900 p-3 rounded-lg"><div class="markdown-content">${content}</div><div class="text-primary animate-pulse">Thinking...</div></div>`;
                    }
                }
                
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            });
        }

        async function generateLearningPath() {
            const contentDiv = document.getElementById('learningPathContent');
            contentDiv.innerHTML = '<div class="text-primary animate-pulse">Generating your personalized learning path...</div>';

            if (!window.Poe) {
                contentDiv.innerHTML = '<div class="text-red-500">AI functionality not available. Please ensure you\'re running this in the Poe environment.</div>';
                return;
            }

            const prompt = `You are an intelligent AI assistant embedded in a personalized learning platform. Create a personalized learning path for this user profile:

${JSON.stringify(userProfile, null, 2)}

Based on this profile, generate:
1. A personalized learning path broken into manageable weekly milestones
2. Weekly curriculum based on their time availability and experience level
3. Specific content recommendations (videos, exercises, projects)
4. Clear goals for each week

Format your response in markdown with clear sections, emojis, and actionable items. Be encouraging and specific to their goal of "${userProfile.goal}".`;

            try {
                await window.Poe.sendUserMessage(prompt, {
                    handler: "learning-path-handler",
                    stream: true,
                    openChat: false
                });
            } catch (err) {
                contentDiv.innerHTML = `<div class="text-red-500">Error: ${err.message}</div>`;
            }
        }

        async function generateQuiz(topic = "current learning topic") {
            const contentDiv = document.getElementById('quizContent');
            contentDiv.innerHTML = '<div class="text-primary animate-pulse">Generating quiz...</div>';

            if (!window.Poe) {
                contentDiv.innerHTML = '<div class="text-red-500">AI functionality not available.</div>';
                return;
            }

            const prompt = `Generate a short interactive quiz (3-5 questions) about ${topic} for a ${userProfile?.experienceLevel || 'beginner'} learner studying ${userProfile?.goal || 'programming'}. 

Format as markdown with:
- Clear question numbering
- Multiple choice options (A, B, C, D)
- Mix of conceptual and practical questions
- Encouraging tone

Make it appropriate for someone who ${userProfile?.currentKnowledge || 'is just starting out'}.`;

            try {
                await window.Poe.sendUserMessage(prompt, {
                    handler: "quiz-handler",
                    stream: true,
                    openChat: false
                });
            } catch (err) {
                contentDiv.innerHTML = `<div class="text-red-500">Error: ${err.message}</div>`;
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const messagesDiv = document.getElementById('chatMessages');
            
            // Add user message
            messagesDiv.innerHTML += `<div class="bg-gray-200 dark:bg-gray-600 p-3 rounded-lg text-right">${message}</div>`;
            input.value = '';
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            if (!window.Poe) {
                messagesDiv.innerHTML += '<div class="bg-red-100 dark:bg-red-900 p-3 rounded-lg">AI functionality not available.</div>';
                return;
            }

            const contextInfo = userProfile ? `The user's profile: ${JSON.stringify(userProfile, null, 2)}` : "No user profile available yet.";
            
            const prompt = `You are a friendly AI tutor for a personalized learning platform. Answer the user's question in a helpful, encouraging way.

${contextInfo}

User question: ${message}

Provide a clear, beginner-friendly answer with examples if helpful. Keep it conversational and supportive.`;

            try {
                await window.Poe.sendUserMessage(prompt, {
                    handler: "chat-handler",
                    stream: true,
                    openChat: false
                });
            } catch (err) {
                messagesDiv.innerHTML += `<div class="bg-red-100 dark:bg-red-900 p-3 rounded-lg">Error: ${err.message}</div>`;
            }
        }

        // Add quiz generation button to learning path
        function addQuizButton(topic) {
            return `<button onclick="generateQuiz('${topic}')" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-lg text-sm transition-colors">Take Quiz ðŸ§ª</button>`;
        }

        // Sample quiz for demo
        document.addEventListener('DOMContentLoaded', () => {
            // Add event listener for quiz generation
            setTimeout(() => {
                if (document.getElementById('quizContent').textContent.includes('Complete a module')) {
                    document.getElementById('quizContent').innerHTML = `
                        <div class="space-y-4">
                            <p class="text-gray-600 dark:text-gray-300 mb-4">Generate a quiz for any topic you're learning:</p>
                            <div class="flex gap-2">
                                <input type="text" id="quizTopic" class="flex-1 px-4 py-3 text-base border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="Enter topic (e.g., Python variables, data types)">
                                <button onclick="generateQuiz(document.getElementById('quizTopic').value || 'programming basics')" class="bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-lg transition-colors">Generate Quiz</button>
                            </div>
                        </div>
                    `;
                }
            }, 1000);
        });
    </script>
</body>
</html>
